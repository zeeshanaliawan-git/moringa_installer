alter table query_settings_published drop `path`;

update es_queries set query = 'select scp.uuid as content_id, scp.name as content_name, bt.id as bloc_template_id, bt.name as bloc_template_name, bt.custom_id as bloc_template_custom_id, bt.type as bloc_template_type, l.langue_code, l.langue_id, scdp.fd_content_data_2 content_data, scdp.id as content_detail_id, f.name as folder_name, f.uuid as folder_id from ##PAGES_DB##.language l inner join ##PAGES_DB##.structured_contents_published scp left outer join ##PAGES_DB##.structured_contents_details_published scdp on scdp.content_id = scp.id and scdp.langue_id = l.langue_id inner join ##PAGES_DB##.bloc_templates bt on bt.id = scp.template_id left outer join ##PAGES_DB##.folders f ON scp.folder_id = f.id where scp.type = ''content'' and scp.site_id = ##site_id## and case when ##sc_uuid## = ''All'' then 1 else scp.uuid end = case when ##sc_uuid## = ''All'' then 1 else ##sc_uuid## end' where name = 'structured_content';
update es_query_levels set j_object_columns = 'id:content_id,name:content_name,folder_name,folder_id' where query_name = 'structured_content' and coalesce(parent_level_id,0) = 0 and j_object = 'structured_content';

update es_queries set query = 'select pfr.uuid as folder_id, pfr.name as folder_name, l.langue_id, p.uuid as page_id, p.name, p.type, p.path, p.langue_code, p.variant, p.html_file_path, coalesce(ccnt.published_url,'''') as published_url, p.canonical_url, p.title, p.meta_keywords, p.meta_description, p.dl_page_type, p.dl_sub_level_1, p.dl_sub_level_2, p.package_name, p.class_name, p.layout, p.social_title, p.social_type, p.social_description, p.social_image, p.social_twitter_message, p.social_twitter_hashtags, p.social_email_subject, p.social_email_popin_title, p.social_email_message, p.social_sms_text, p.publish_status, p.row_height, p.item_margin_x, p.item_margin_y, p.container_padding_x, p.container_padding_y, p.dynamic_html, p.layout_data, p.get_html_status, ptags.tag_id tag_id, pmt.meta_name, pmt.meta_content, pb.sort_order bloc_sort_order, b.name bloc_name, b.uuid bloc_id, ptm.uuid as template_id, ptm.name as template_name, ptm.custom_id as template_custom_id, ptm.description as template_description, ptm.template_code as template_code, ptm.is_system as template_is_system, pti.id as item_id, pti.name as item_name, pti.custom_id as item_custom_id, pti.sort_order as item_sort_order, ptib.sort_order as item_bloc_sort_order, ib.uuid as item_bloc_id, ib.name as item_bloc_name, ptid.css_classes as item_detail_css_classes, ptid.css_style item_detail_css_style, pf.form_id as form_id, pf.sort_order page_form_sort_order from ##PAGES_DB##.pages p left outer join ##PAGES_DB##.language l on l.langue_code = p.langue_code left outer join ##PAGES_DB##.folders pfr on pfr.id = p.folder_id left outer join ##PORTAL_DB##.cached_content_view ccnt on ccnt.site_id = p.site_id and ccnt.content_type = ''page'' and ccnt.content_id = p.id and ccnt.lang = l.langue_code left outer join ##PAGES_DB##.pages_tags ptags on ptags.page_id = p.id left outer join ##PAGES_DB##.pages_meta_tags pmt on pmt.page_id = p.id left outer join ##PAGES_DB##.pages_blocs pb on pb.page_id = p.id left outer join ##PAGES_DB##.blocs b on b.id = pb.bloc_id left outer join ##PAGES_DB##.page_templates ptm on ptm.id = p.template_id left outer join ##PAGES_DB##.page_templates_items pti on pti.page_template_id = ptm.id left outer join ##PAGES_DB##.page_templates_items_blocs ptib on ptib.item_id = pti.id and ptib.langue_id = l.langue_id left outer join ##PAGES_DB##.blocs ib on ib.id = ptib.bloc_id left outer join ##PAGES_DB##.page_templates_items_details ptid on ptid.item_id = pti.id and ptid.langue_id = l.langue_id left outer join ##PAGES_DB##.pages_forms pf on pf.page_id = p.id where p.type = ''freemarker'' and p.site_id = ##site_id## and p.id = ##page_id##' where name = 'pages';

update es_queries set query = 'select bt.id as bloc_template_id, bt.name as bloc_template_name, bt.custom_id as bloc_template_custom_id, bt.type as bloc_template_type, l.langue_code, l.langue_id, scp.id content_id, scp.uuid content_uuid, scp.name content_name, scp.publish_status content_publish_status, scdp.fd_content_data_2 content_data,f.name as folder_name, f.uuid as folder_id,fd.path_prefix folder_path_prefix,pg.canonical_url page_canonical_url,pg.uuid AS page_id,pg.NAME AS page_name,pg.type AS page_type,pg.path AS page_path,pg.publish_status AS page_publish_status,coalesce(ccnt.published_url,'''') as published_url from ##PAGES_DB##.language l inner join ##PAGES_DB##.structured_contents_published scp left outer join ##PAGES_DB##.structured_contents_details_published scdp on scdp.content_id = scp.id and scdp.langue_id = l.langue_id left outer JOIN ##PAGES_DB##.pages pg ON pg.id = scdp.page_id and pg.langue_code = l.langue_code left outer join ##PORTAL_DB##.cached_content_view ccnt on ccnt.content_type = ''page'' and ccnt.content_id = pg.id and ccnt.lang = l.langue_code and ccnt.site_id = pg.site_id inner join ##PAGES_DB##.bloc_templates bt on bt.type <> ''store'' and bt.id = scp.template_id left outer join ##PAGES_DB##.folders f ON scp.folder_id = f.id left outer join ##PAGES_DB##.folders_details fd ON fd.folder_id = f.id AND l.langue_id = fd.langue_id where scp.type = ''page'' and scp.publish_status = ''published'' and scp.site_id = ##site_id## and case when ##sc_uuid## = ''All'' then 1 else scp.uuid end = case when ##sc_uuid## = ''All'' then 1 else ##sc_uuid## end ' where name = 'structured_page';

update es_queries set query = 'select bt.id as bloc_template_id, bt.name as bloc_template_name, bt.custom_id as bloc_template_custom_id, bt.type as bloc_template_type, l.langue_code, l.langue_id, scp.id content_id, scp.uuid content_uuid, scp.name content_name, scp.publish_status content_publish_status, scdp.fd_content_data_2 content_data,f.name as folder_name, f.uuid as folder_id,fd.path_prefix folder_path_prefix,pg.canonical_url page_canonical_url,pg.uuid AS page_id,pg.NAME AS page_name,pg.type AS page_type,pg.path AS page_path,pg.publish_status AS page_publish_status,coalesce(ccnt.published_url,'''') as published_url from ##PAGES_DB##.language l inner join ##PAGES_DB##.structured_contents_published scp left outer join ##PAGES_DB##.structured_contents_details_published scdp on scdp.content_id = scp.id and scdp.langue_id = l.langue_id left outer JOIN ##PAGES_DB##.pages pg ON pg.id = scdp.page_id and pg.langue_code = l.langue_code left outer join ##PORTAL_DB##.cached_content_view ccnt on ccnt.content_type = ''page'' and ccnt.content_id = pg.id and ccnt.lang = l.langue_code and ccnt.site_id = pg.site_id inner join ##PAGES_DB##.bloc_templates bt on bt.type = ''store'' and bt.id = scp.template_id left outer join ##PAGES_DB##.folders f ON scp.folder_id = f.id left outer join ##PAGES_DB##.folders_details fd ON fd.folder_id = f.id AND l.langue_id = fd.langue_id where scp.type = ''page'' and scp.publish_status = ''published'' and scp.site_id = ##site_id## and case when ##sc_uuid## = ''All'' then 1 else scp.uuid end = case when ##sc_uuid## = ''All'' then 1 else ##sc_uuid## end' where name = 'stores';

update es_queries set query = 'select date_format(fp.created_ts, ''%Y-%m-%d'') as page_created_date, DATE_FORMAT(fp.created_ts,''%H:%i:%s'') as page_created_time, date_format(fp.updated_ts, ''%Y-%m-%d'') as page_updated_date, DATE_FORMAT(fp.updated_ts,''%H:%i:%s'') as page_updated_time, date_format(fp.published_ts, ''%Y-%m-%d'') as page_published_date, DATE_FORMAT(fp.published_ts,''%H:%i:%s'') as page_published_time, fp.uuid as page_id, fp.name as page_name, pfr.uuid as folder_id, pfr.name as folder_name, l.langue_id, p.uuid as langue_page_id, p.path, p.langue_code, p.variant, p.html_file_path, coalesce(ccnt.published_url,'''') as published_url, p.canonical_url, p.title, p.meta_keywords, p.meta_description, p.dl_page_type, p.dl_sub_level_1, p.dl_sub_level_2, p.package_name, p.class_name, p.layout, p.social_title, p.social_type, p.social_description, p.social_image, p.social_twitter_message, p.social_twitter_hashtags, p.social_email_subject, p.social_email_popin_title, p.social_email_message, p.social_sms_text, p.publish_status, p.row_height, p.item_margin_x, p.item_margin_y, p.container_padding_x, p.container_padding_y, p.dynamic_html, p.layout_data, p.get_html_status, ptags.tag_id tag_id, coalesce(ctags.label, ptags.tag_id) as tag_label, pmt.meta_name, pmt.meta_content, pb.sort_order bloc_sort_order, date_format(b.created_ts, ''%Y-%m-%d'') as bloc_created_date, DATE_FORMAT(b.created_ts,''%H:%i:%s'') as bloc_created_time, date_format(b.updated_ts, ''%Y-%m-%d'') as bloc_updated_date, DATE_FORMAT(b.updated_ts,''%H:%i:%s'') as bloc_updated_time, b.name bloc_name, b.uuid bloc_id, ptm.uuid as template_id, ptm.name as template_name, ptm.custom_id as template_custom_id, ptm.description as template_description, ptm.template_code as template_code, ptm.is_system as template_is_system, pti.id as item_id, pti.name as item_name, pti.custom_id as item_custom_id, pti.sort_order as item_sort_order, ptib.sort_order as item_bloc_sort_order, ib.uuid as item_bloc_id, ib.name as item_bloc_name, ptid.css_classes as item_detail_css_classes, ptid.css_style item_detail_css_style, pf.form_id as form_id, pf.sort_order page_form_sort_order from ##PAGES_DB##.freemarker_pages fp inner join ##PAGES_DB##.pages p on fp.id = p.parent_page_id and p.type = ''freemarker'' left outer join ##PAGES_DB##.language l on l.langue_code = p.langue_code left outer join ##PAGES_DB##.folders pfr on pfr.id = fp.folder_id left outer join ##PORTAL_DB##.cached_content_view ccnt on ccnt.site_id = p.site_id and ccnt.content_type = ''page'' and ccnt.content_id = p.id and ccnt.lang = l.langue_code left outer join ##PAGES_DB##.pages_tags ptags on ptags.page_id = p.parent_page_id and ptags.page_type = ''freemarker'' left join ##PREPROD_CATALOG_DB##.tags ctags on ctags.id = ptags.tag_id and ctags.site_id = ##site_id##  left outer join ##PAGES_DB##.pages_meta_tags pmt on pmt.page_id = p.id left outer join ##PAGES_DB##.parent_pages_blocs pb on pb.type = ''freemarker'' and pb.page_id = fp.id left outer join ##PAGES_DB##.blocs b on b.id = pb.bloc_id left outer join ##PAGES_DB##.page_templates ptm on ptm.id = p.template_id left outer join ##PAGES_DB##.page_templates_items pti on pti.page_template_id = ptm.id left outer join ##PAGES_DB##.page_templates_items_blocs ptib on ptib.item_id = pti.id and ptib.langue_id = l.langue_id left outer join ##PAGES_DB##.blocs ib on ib.id = ptib.bloc_id left outer join ##PAGES_DB##.page_templates_items_details ptid on ptid.item_id = pti.id and ptid.langue_id = l.langue_id left outer join ##PAGES_DB##.parent_pages_forms pf on pf.type = ''freemarker'' and pf.page_id = fp.id where fp.site_id = ##site_id## and fp.id = ##page_id##' where name = 'pages';

update es_queries set query = 'select bt.id as bloc_template_id, bt.name as bloc_template_name, bt.custom_id as bloc_template_custom_id, bt.type as bloc_template_type, l.langue_code, l.langue_id, scp.id content_id, scp.uuid content_uuid, scp.name content_name, date_format(scp.created_ts, ''%Y-%m-%d'') as content_created_date, DATE_FORMAT(scp.created_ts,''%H:%i:%s'') as content_created_time, date_format(scp.updated_ts, ''%Y-%m-%d'') as content_updated_date, DATE_FORMAT(scp.updated_ts,''%H:%i:%s'') as content_updated_time, date_format(scp.published_ts, ''%Y-%m-%d'') as content_published_date, DATE_FORMAT(scp.published_ts,''%H:%i:%s'') as content_published_time, scp.publish_status content_publish_status, scdp.fd_content_data_3 content_data,f.name as folder_name, f.uuid as folder_id,fd.path_prefix folder_path_prefix,date_format(pg.created_ts, ''%Y-%m-%d'') as page_created_date, DATE_FORMAT(pg.created_ts,''%H:%i:%s'') as page_created_time, date_format(pg.updated_ts, ''%Y-%m-%d'') as page_updated_date, DATE_FORMAT(pg.updated_ts,''%H:%i:%s'') as page_updated_time, date_format(pg.published_ts, ''%Y-%m-%d'') as page_published_date, DATE_FORMAT(pg.published_ts,''%H:%i:%s'') as page_published_time,pg.canonical_url page_canonical_url,pg.uuid AS page_id,pg.NAME AS page_name,pg.type AS page_type,pg.path AS page_path,pg.publish_status AS page_publish_status,coalesce(ccnt.published_url,'''') as published_url,ptags.tag_id tag_id, coalesce(ctags.label, ptags.tag_id) as tag_label from ##PAGES_DB##.language l inner join ##PAGES_DB##.structured_contents_published scp left outer join ##PAGES_DB##.structured_contents_details_published scdp on scdp.content_id = scp.id and scdp.langue_id = l.langue_id left outer JOIN ##PAGES_DB##.pages pg ON pg.id = scdp.page_id and pg.langue_code = l.langue_code left join ##PAGES_DB##.pages_tags ptags on ptags.page_id = pg.parent_page_id and ptags.page_type = ''structured'' left join ##PREPROD_CATALOG_DB##.tags ctags on ctags.id = ptags.tag_id and ctags.site_id = ##site_id## left outer join ##PORTAL_DB##.cached_content_view ccnt on ccnt.content_type = ''page'' and ccnt.content_id = pg.id and ccnt.lang = l.langue_code and ccnt.site_id = pg.site_id inner join ##PAGES_DB##.bloc_templates bt on bt.type <> ''store'' and bt.id = scp.template_id left outer join ##PAGES_DB##.folders f ON scp.folder_id = f.id left outer join ##PAGES_DB##.folders_details fd ON fd.folder_id = f.id AND l.langue_id = fd.langue_id where scp.type = ''page'' and scp.site_id = ##site_id## and case when ##sc_uuid## = ''All'' then 1 else scp.template_id end = case when ##sc_uuid## = ''All'' then 1 else ##sc_uuid## end' where name = 'structured_page';

insert into es_query_levels (query_name, parent_level_id, j_object, j_object_key, j_object_columns) select 'structured_page', id, 'tags', 'tag_id', 'id:tag_id,label:tag_label' from es_query_levels where query_name= 'structured_page' and coalesce(parent_level_id,'') = '';